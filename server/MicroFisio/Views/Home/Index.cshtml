@model MicroFisio.Models.ViewModels.HomeIndexViewModel
@{
    ViewData["Title"] = "Início";
    var dateStr = Model.Data.ToString("yyyy-MM-dd");
}
<link rel="stylesheet" href="~/css/Agenda.css" />

<div class="container mt-3">
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <h5 class="card-title mb-0">Agenda de hoje</h5>
          <small class="text-muted">@Model.Data.ToString("dd/MM/yyyy")</small>
        </div>
        <div>
          <a class="btn btn-sm btn-outline-secondary" asp-controller="Agenda" asp-action="Index" asp-route-mode="day" asp-route-date="@dateStr">Ver mais</a>
        </div>
      </div>

      <ul class="agenda-day-list">
        @if (Model.Itens.Count == 0)
        {
          <li class="agenda-day-empty">Sem agendamentos para hoje.</li>
        }
        else
        {
          foreach (var item in Model.Itens)
          {
            var css = (item.Status ?? "agendada").ToLowerInvariant();
            var nome = Model.PacienteNomes.ContainsKey(item.PacienteId) ? Model.PacienteNomes[item.PacienteId] : item.PacienteId;
            var hora = item.DataHoraInicio.ToLocalTime().ToString("HH:mm");
            if (css == "concluida" && !string.IsNullOrEmpty(item.RelatorioId))
            {
              <li class="agenda-day-item @css">
                <a asp-controller="Relatorio" asp-action="Details" asp-route-id="@item.RelatorioId">
                  <span class="time">@hora</span>
                  <span class="title">@item.Tipo - @nome</span>
                </a>
              </li>
            }
            else
            {
              <li class="agenda-day-item @css">
                <div>
                  <span class="time">@hora</span>
                  <span class="title">@item.Tipo - @nome</span>
                </div>
              </li>
            }
          }
        }
      </ul>
    </div>
  </div>

  <h5 class="mb-2 mt-4">Informações de atendimento</h5>
  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">Cadastrar Paciente</h6>
          <p class="text-muted">Registre um novo paciente antes de agendar.</p>
          <div class="mt-auto">
            <a class="btn btn-sm btn-primary" asp-controller="Paciente" asp-action="Create">Cadastrar</a>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">Anamnese</h6>
          <p class="text-muted">Formulário de anamnese e histórico do paciente.</p>
          <div class="mt-auto">
            <a class="btn btn-sm btn-outline-primary" asp-controller="Anamnese" asp-action="Index">Abrir anamnese</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
